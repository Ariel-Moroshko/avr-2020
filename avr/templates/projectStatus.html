{% extends "studentLayout.html" %} 
{% block styles %}

<style>
[class*=tracking-status-] p {
 margin:0;
 color:#fff;
 text-align:center;
}
[class*=tracking-status-] {
 padding:1rem 0
}

.video-processing {
	color: #0e0073;
	background-color: #c5d7ff;
	border-color: #d4d4fa;
}

.video-completed {
	color: #005e0d;
    background-color: #daffdf;
	border-color: #daffde;
}

.video-failed {
	color: #75002a;
	background-color: #ffdae9;
	border-color: #ffe0f4;
}

.btn-danger {
	border-radius: 1.1rem;
}

.check-video {
	background-color: #d13cbf;
	color: #fff;
	border-color: #dc35a9;
	border-radius: 1.25rem;
}

.check-video:hover {
	background-color: #ce08b7;
	color: #fff;
}


.tracking-content {
	line-height: 2.6rem;
}
.tracking-item {
 border-right:1px solid #c5c5c5;
 position:relative;
 padding:0.7rem 2.2rem 0.7rem 2.5rem;
 margin: 0 3rem 0 0;
 min-height:2rem;
}
.tracking-item:last-child {
 padding-bottom:1.3rem;
}
.tracking-item .tracking-date {
 margin-bottom:.5rem
}
.tracking-item .tracking-date span {
 color:#888;
 font-size:85%;
 padding-left:.4rem
}
.tracking-item .tracking-content {
 /* padding:.5rem .8rem; */
 border-radius:.5rem;
 text-align: right;
 font-size: 1.1rem;
}
.tracking-item .tracking-content span {
 font-size: 1.1rem;
 color:#888;
 font-size:85%
}
.tracking-item .tracking-icon {
 position:absolute;
 right:-1.3rem;
 width:2.6rem;
 height:2.6rem;
 text-align:right;
 border-radius:50%;
 font-size:1.1rem;
 background-color:#fff;
 color:#fff
}
.tracking-item .tracking-icon.status-completed {
 color:#6dec8b;
 border:3px solid #98ffb0;
}
.tracking-item .tracking-icon.status-not-completed {
 color:#dadada;
 border:3px solid #eeeeee;
}
.tracking-item .tracking-icon.status-draft {
 color:#ffdc87;
 border:3px solid #ffedc0;
}

@keyframes fadeIn {
	from {opacity: 0}
	to {opacity: 1}
}

.fadeInAnimated {
	opacity: 0;
	animation: fadeIn 0.4s forwards;
}

@media(min-width:992px) {
 .tracking-item .tracking-date {
  position:absolute;
  left:-10rem;
  width:7.5rem;
  text-align:right
 }
 .tracking-item .tracking-date span {
  display:block
 }
 .tracking-item .tracking-content {
  padding:0;
  background-color:transparent
 }
}

</style>
{% endblock styles %}

{% block content %}

{% if isStudentEnrolledInProject %}
<div class="pageTitle">
	<nav aria-label="breadcrumb" id="breadcrumb">
		<ol class="breadcrumb" style="background-color: transparent; padding: 0rem 3rem;">
			<li class="breadcrumb-item"><a href="/home">My Projects</a></li>
			<li class="breadcrumb-item active" aria-current="page">{{ project.title }} - Project Status</li>
		</ol>
	</nav>
</div>
{% endif %}

<div class="container fadeInAnimated">
	{% if not isStudentEnrolledInProject %}
		<div class="col-sm-7 mx-auto" style="margin-top:6em">
			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					{% for category, message in messages %}
						<div class="alert alert-{{ category }}">
							{{ message }}
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}
		</div>

	{% else %}
		<div class="col-sm-7 mx-auto mt-4 pb-0">
			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					{% for category, message in messages %}
						<div class="alert alert-{{ category }}">
							{{ message }}
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}
			
			<div id="videoProcessing" class="alert video-processing shadow" style="display: {{ 'block' if project.youtubeUploadStatus == 'uploading' or project.youtubeUploadStatus == 'deleting current' or (project.youtubeProcessingStatus == '' and project.youtubeUploadStatus == 'completed') or project.youtubeProcessingStatus == 'checking' or project.youtubeProcessingStatus == 'processing' else 'none' }}">
				Your video is currently being uploaded to YouTube<br>
				(may take a few minutes)<br>
				Project doc will be sent once your video is successfully processed.<br>
				<div class="spinner-border mt-3"></div>
			</div>

			<div id="videoCompleted" class="alert video-completed shadow py-3" style="display: none">
				<div class="row justify-content-center">
					<div class="col-12 col-md-2 my-auto">
						<i class="far fa-check-circle" style="font-size: 3.7rem;"></i>
					</div>
					<div class="col-12 col-md-9 mt-3 mt-md-0 py-3">
							Your video has been uploaded and processed by YouTube.<br>
							Project doc was sent successfully!<br>
					</div>			
				</div>
			</div>
	
		
			<div id="videoFailed" class="alert video-failed shadow py-3" style="display: {{ 'block' if project.youtubeUploadStatus == 'failed' or project.youtubeProcessingStatus == 'terminated' or project.youtubeProcessingStatus == 'failed' else 'none' }}">
				<div class="row justify-content-center">
					<div class="col-12 col-md-2 my-auto">
						<i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
					</div>
					<div class="col-12 col-md-8 mt-3 mt-md-0">
						There was an error processing your video.<br>
						<span name="transcodeFailed" style="display: {{ 'block' if project.youtubeProcessingFailureReason == 'transcodeFailed' else 'none' }}">(Content transcoding has failed)<br></span>
						Please try to resend your video.<br>
						<a href="/ProjectStatus/{{ project.id }}/EditProjectDoc" class="btn btn-danger mr-2 px-3 mt-3 shadow">Resend video</a>
					</div>			
				</div>
			</div>
			
		</div>

		
 	<div class="row mt-4">
	<div class="col-12 col-md-8 col-lg-6 col-xl-5 mx-auto mt-4">
		<div class="panel shadow mx-auto" style="margin-bottom:4em; background-color:#fff; border-radius: 0.8rem; overflow:hidden;">
			<div class="panel-heading text-center py-3 px-4 overflow:hidden" style="color:#fff; background-color:#2a3035;">
				<h2 class="mt-2" style="font-size: 1.7rem;">{{ project.title }}</h2>
				<h6 class="mt-2">{{ project.semester }} {{ project.year }}</h6>
			</div>
			<div class="panel-body">
				<div class="tracking-item pt-4">
					<div
						class="tracking-icon {% if project.requirementsDoc %} status-completed{% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>		
					<div class="tracking-content">
						מסמך דרישות
					</div>
				</div>
				<div class="tracking-item">
					<div
						class="tracking-icon {% if project.firstMeeting %} status-completed{% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>		
					<div class="tracking-content">פגישת התנעה</div>
				</div>
				<div class="tracking-item">
					<div
						class="tracking-icon {% if project.halfwayPresentation %} status-completed{% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>
					<div class="tracking-content">מצגת אמצע</div>
				</div>
				<div class="tracking-item">
					<div
						class="tracking-icon {% if project.finalMeeting %} status-completed{% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>
					<div class="tracking-content">פגישת סיום</div>
				</div>
				<div class="tracking-item">
					<div
						class="tracking-icon {% if project.equipmentReturned %} status-completed{% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>
					<div class="tracking-content">החזרת ציוד</div>
				</div>
				<div class="tracking-item" name="projectDocStatus">
					<div
						class="tracking-icon {% if project.projectDoc %} status-completed {% elif project.youtubeProcessingStatus == 'processed' %} status-draft {% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>
					<div class="tracking-content">
						{% if project.finalMeeting %}
							{% if not project.projectDocImage %}
								<a href="/ProjectStatus/{{ project.id }}/SendProjectDoc" class="btn btn btn-outline-dark mr-2 px-3 shadow">שלח</a>
							{% elif project.projectDocEditableByStudents %}
								<a href="/ProjectStatus/{{ project.id }}/EditProjectDoc" class="btn btn btn-outline-dark mr-2 px-3 shadow" id="editProjectDocLink" style="display: {{ 'none' if project.youtubeUploadStatus == 'uploading' or project.youtubeProcessingStatus == 'checking' or project.youtubeProcessingStatus == '' or project.youtubeUploadStatus == 'deleting current' else 'inline-block' }}">ערוך</a>
							{% endif %}
						{% endif %}
						דף פרוייקט
					</div>
				</div>
				<div class="tracking-item">
					<div
						class="tracking-icon {% if project.posterStatus %} status-completed {% else %} status-not-completed{% endif %}">
						<svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle"
							role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
							<path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
							</path>
						</svg>
					</div>
					<div class="tracking-content">
						{% if project.gradeStatus and project.posterEditableByStudents %}
							<a href="/ProjectStatus/{{ project.id }}/SendPoster" class="btn btn btn-outline-dark mr-2 px-3 shadow" id="sendPosterLink">שלח</a>
						{% endif %}
						פוסטר
					</div>
				</div>
			</div>
		</div>
		
	</div>
 	</div>
	<div class="row mt-5 mx-auto pt-3">
		<div class="col-lg-6 bg-white shadow mb-5 mt-5" style="margin: auto; padding:0; font-size:1.1rem;border-radius: 0.8rem;">
			<div style="background-color: #2a3035; padding: 20px;color:#fff;border-radius: 0.8rem 0.8rem 0 0;">Additional Information</div>
			<div class="row p-4 text-left">
				<div class="col-12 col-md-6 my-auto text-center">
					<i class="fas fa-users" style="font-size: 2em;vertical-align: middle;"></i>
					<span class="ml-4">Students</span>
				</div>
				<div class="col col-md-auto mx-auto mt-4 mt-md-0">
					<ul class="fa-ul text-left">
					{% for studentName in project.studentsFullNameEng %}
						<li class="pb-1"><span class="fa-li"><i class="fas fa-chevron-circle-right"></i></span><span style="vertical-align: middle">{{ studentName }}</span></li>
					{% endfor %}
					</ul>
				</div>
			</div>
			<div class="row p-4 text-left">
				<div class="col-12 col-md-6 my-auto text-center ml-md-2">
					<i class="fas fa-user-graduate" style="font-size: 2em;vertical-align: middle;"></i>
					<span class="ml-4">Supervisors</span>
				</div>
				<div class="col col-md-auto mx-auto mt-4 mt-md-0">
					<ul class="fa-ul text-left">
					{% for supervisorName in project.supervisorsFullNameEng %}
						<li class="pb-1"><span class="fa-li"><i class="fas fa-chevron-circle-right"></i></span><span style="vertical-align: middle">{{ supervisorName }}</span></li>
					{% endfor %}
					</ul>
				</div>
			</div>
		</div>
	
	</div>
		{% if project.comments %}
			<div class="row mt-4 mx-auto">
				<div class="col-lg-6 bg-white shadow mb-5 mt-3"
					style="margin: auto; padding:0; font-size:1.1rem;border-radius: 0.8rem;">
					<div style="background-color: #2a3035; padding: 20px;color:#fff;border-radius: 0.8rem 0.8rem 0 0;">Supervisor's
						Notes</div>
					<div class="row p-4">
						<div class="col text-right" style="direction: rtl">
							{{ project.comments }}
						</div>
						<div class="col-1 px-4"><i class="fas fa-chevron-circle-left"></i></div>
					</div>
				</div>
			</div>
		{% endif %}
	{% endif %}
	<img src="/static/images/powered_by.png" class="mt-5 img-responsive">
</div>

{% endblock content %}

{% block scripts %} 
<script>
	{% if project.projectDocImage and project.youtubeProcessingStatus != "processed" %}
		function handleProcessingSucceeded() {
			$("#videoProcessing").hide();
			$("#videoCompleted").fadeIn();
			$("#editProjectDocLink").fadeIn();
			$("div[name='projectDocStatus'] .tracking-icon").removeClass("status-not-completed");
			$("div[name='projectDocStatus'] .tracking-icon").addClass("status-draft");
			$("div[name='projectDocStatus'] svg").attr("data-original-title", "נשלח אך עדיין לא אושר");
		}	
	
		function handleProcessingFailed(failureReason) {
			$("#videoProcessing").hide();
			if(failureReason == 'transcodeFailed') {
				$("#videoFailed span[name='transcodeFailed']").show();
			}
			$("#videoFailed").fadeIn();
			$("#editProjectDocLink").fadeIn();
		}

		let server = new EventSource(`${window.location.href}/YoutubeStatus`);
		server.onmessage = function(event) {
			let response = JSON.parse(event.data);
			if(response.uploadStatus == "failed" || response.processingStatus == "terminated" || response.processingStatus == "failed") {
				handleProcessingFailed(response.processingFailureReason);
				server.close();
			}
			else if(response.uploadStatus == "completed" && response.processingStatus == "processed") {
				handleProcessingSucceeded();
				server.close();
			}
		}
		
		if(!!window.performance && window.performance.navigation.type === 2){
			window.location.reload();
		}
	{% endif %}


	$(function () {
    	$('[data-toggle="tooltip"]').tooltip()
	})
	$("div.status-completed svg").attr({
		"data-toggle": "tooltip", 
		"title": "הושלם",
		"data-placement": "left"
	});
	$("div.status-draft svg").attr({
		"data-toggle": "tooltip", 
		"title": "נשלח אך עדיין לא אושר",
		"data-placement": "left"
	});
	$("div.status-not-completed svg").attr({
		"data-toggle": "tooltip", 
		"title": "לא הושלם",
		"data-placement": "left"
	});
</script>
{% endblock scripts %}